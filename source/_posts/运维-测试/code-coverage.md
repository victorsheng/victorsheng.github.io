---
title: 代码覆盖率
abbrlink: 354781003
date: 2018-04-21 14:18:46
tags:
categories:
---
# 代码覆盖率工具

目前Java常用覆盖率工具Jacoco、Emma和Cobertura

# 两种模式
主流代码覆盖率工具都采用字节码插桩模式，通过钩子的方式来记录代码执行轨迹信息。其中字节码插桩又分为两种模式On-The-Fly和Offine
- On-The-Fly模式优点在于无需修改源代码，可以在系统不停机的情况下，实时收集代码覆盖率信息。
- Offine模式优点在于系统启动不需要额外开启代理，但是只能在系统停机的情况下才能获取代码覆盖率。 

# 情景
## 单元测试覆盖率
选取了Sonar+Cobertura来获取单元测试覆盖率。 

## 集成测试覆盖率

## 自动化集成流程

![upload successful](/images/pasted-158.png)

1. 业务开发完成之后，开发人员做单元测试，单元测试完成之后，保证单元测试全部通过同时单元测试代码覆盖率达到一定程度（这个需要开发和测试约定，理论上越高越好），开发提测。 
2. 测试人员根据测试用例进行测试（包括手工测试和自动化测试），结合git获取本次变动代码的覆盖率信息。行覆盖率需达到100%，分支达到50%以上，这个需要具体场景具体分析。 
3. 测试通过之后，代码合并至主干，进行自动化回归。 
4. 回归测试通过之后，代码可以上线。

# 总结
- 代码覆盖率统计是用来发现没有被测试覆盖的代码
- 代码覆盖率统计不能完全用来衡量代码质量


# 参考
https://tech.youzan.com/code-coverage/