---
layout: "post"
title: "阿里消息队列服务"
date: "2018-03-25 02:14"
---
# 顺序消息
## 全局顺序

对于指定的一个 Topic，所有消息按照严格的先入先出（FIFO）的顺序进行发布和消费。

![](http://docs-aliyun.cn-hangzhou.oss.aliyun-inc.com/assets/pic/49319/cn_zh/1483698857982/ordermsg1.png "ordered-msg-1")

### 适用场景：

* 性能要求不高，所有的消息严格按照 FIFO 原则进行消息发布和消费的场景。

### 举例说明：

* 【例一】证券处理中，以人民币兑换美元为 Topic，在价格相同的情况下，先出价者优先处理，则可以通过全局顺序的方式按照 FIFO 的方式进行发布和订阅。

## 分区顺序

对于指定的一个 Topic，所有消息根据 sharding key 进行区块分区。同一个分区内的消息按照严格的 FIFO 顺序进行发布和消费。Sharding key 是顺序消息中用来区分不同分区的关键字段，和普通消息的 Key 是完全不同的概念。

![](http://docs-aliyun.cn-hangzhou.oss.aliyun-inc.com/assets/pic/49319/cn_zh/1483698891347/ordermsg2.png "ordered-msg-2")

### 适用场景：

* 性能要求高，以 sharding key 作为分区字段，在同一个区块中严格的按照 FIFO 原则进行消息发布和消费的场景。

### 举例说明：

* 【例一】用户注册需要发送发验证码，以用户 ID 作为 sharding key， 那么同一个用户发送的消息都会按照先后顺序来发布和订阅。

* 【例二】电商的订单创建，以订单 ID 作为 sharding key，那么同一个订单相关的创建订单消息、订单支付消息、订单退款消息、订单物流消息都会按照先后顺序来发布和订阅。

阿里巴巴集团内部电商系统均使用此种分区顺序消息，既保证业务的顺序，同时又能保证业务的高性能。



## 全局顺序与分区顺序对比

在控制台创建顺序消息使用的 Topic，各种类型 Topic 对比如下。

**消息类型对比**

| Topic 类型 | 支持事务消息 | 支持定时消息 | 性能 |
| :--- | :--- | :--- | :--- |
| 无序消息 | 是 | 是 | 最高 |
| 分区顺序 | 否 | 否 | 高 |
| 全局顺序 | 否 | 否 | 一般 |

**发送方式对比**

| 消息类型 | 支持可靠同步发送 | 支持可靠异步发送 | 支持 Oneway 发送 |
| :--- | :--- | :--- | :--- |
| 无序消息 | 是 | 是 | 是 |
| 分区顺序 | 是 | 否 | 否 |
| 全局顺序 | 是 | 否 | 否 |
