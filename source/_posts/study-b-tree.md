title: study-b-tree
tags:
  - 数据结构
categories: []
date: 2018-01-05 11:16:00
---
# b-树
- 数据库索引使用b-树
- 二叉树查找的时间复杂度O(logN)
- 问题:磁盘IO
- 最坏的情况下,磁盘IO等于索引树的高度
- 把原来"瘦高"的树结构变得"矮胖"就是b-树的特征之一
- B树是一种<b>多路</b>平衡查找树
- B树与红黑树最大的不同在于，B树的结点可以有许多子女，从几个到几千个。

![upload successful](/images/pasted-12.png)



# 定义

1. 树中每个结点最多含有m个孩子（m>=2）；
2. 除根结点和叶子结点外，其它每个结点至少有[ceil(m / 2)]个孩子（其中ceil(x)是一个取上限的函数）；
3. 根结点至少有2个孩子（除非B树只包含一个结点：根结点）；
4. 所有叶子结点都出现在同一层，叶子结点不包含任何关键字信息(可以看做是外部结点或查询失败的结点，指向这些结点的指针都为null)；（注：叶子节点只是没有孩子和指向孩子的指针，这些节点也存在，也有元素。类似红黑树中，每一个NULL指针即当做叶子结点，只是没画出来而已）。
5. 每个非终端结点中包含有n个关键字信息： (n，P0，K1，P1，K2，P2，......，Kn，Pn)。其中：  
a) Ki (i=1...n)为关键字，且关键字按顺序升序排序K(i-1)< Ki。  
b) Pi为指向子树根的结点，且指针P(i-1)指向子树种所有结点的关键字均小于Ki，但都大于K(i-1)。   
c) 关键字的个数n必须满足： [ceil(m / 2)-1]<= n <= m-1。比如有j个孩子的非叶结点恰好有j-1个关键码。

# 应用
- 文件系统
- 数据库索引


# b+树
- 1.有k个子树的中间节点包含有k个元素（B树中是k-1个元素），每个元素不保存数据，只用来索引，所有数据都保存在叶子节点。
- 2.所有的叶子结点中包含了全部元素的信息，及指向含这些元素记录的指针，且叶子结点本身依关键字的大小自小而大顺序链接。
- 3.所有的中间节点元素都同时存在于子节点，在子节点元素中是最大（或最小）元素。
- b+树种,只有叶子节点带有卫星信息,其余中间节点仅仅是索引,没有任何数据关联
- 在数据库的聚集索引（Clustered Index）中，叶子节点直接包含卫星数据。在非聚集索引（NonClustered Index）中，叶子节点带有指向卫星数据的指针。

![upload successful](/images/pasted-13.png)

# B+树的优势：
1.单一节点存储更多的元素，使得查询的IO次数更少。
2.所有查询都要查找到叶子节点，查询性能稳定。
3.所有叶子节点形成有序链表，便于范围查询。

# 引用
- mysql的b树索引的物理文件


# B*树
- B*-tree是B+-tree的变体，在B+树的基础上(所有的叶子结点中包含了全部关键字的信息，及指向含有这些关键字记录的指针)，B*树中非根和非叶子结点再增加指向兄弟的指针；B*树定义了非叶子结点关键字个数至少为(2/3)*M，即块的最低使用率为2/3（代替B+树的1/2）。

![upload successful](/images/pasted-14.png)

B+树的分裂：当一个结点满时，分配一个新的结点，并将原结点中1/2的数据复制到新结点，最后在父结点中增加新结点的指针；B+树的分裂只影响原结点和父结点，而不会影响兄弟结点，所以它不需要指向兄弟的指针。

B\*树的分裂：当一个结点满时，如果它的下一个兄弟结点未满，那么将一部分数据移到兄弟结点中，再在原结点插入关键字，最后修改父结点中兄弟结点的关键字（因为兄弟结点的关键字范围改变了）；如果兄弟也满了，则在原结点与兄弟结点之间增加新结点，并各复制1/3的数据到新结点，最后在父结点增加新结点的指针。

所以，B\*树分配新结点的概率比B+树要低，空间使用率更高；

# 总结

通过以上介绍，大致将B树，B+树，B*树总结如下：

* B树：有序数组+平衡多叉树；
* B+树：有序数组链表+平衡多叉树；
* B\*树：一棵丰满的B+树。


顺便说一句，无论是B树，还是B+树、b*树，由于根或者树的上面几层被反复查询，所以这几块可以存在内存中，换言之，B树、B+树、B*树的根结点和部分顶层数据在内存中，大部分下层数据在磁盘上。


# mysql中InnoDB索引和MyISAM索引的区别：
- 主索引的区别，InnoDB的数据文件本身就是索引文件。而MyISAM的索引和数据是分开的。
- 辅助索引的区别：InnoDB的辅助索引data域存储相应记录主键的值而不是地址。而MyISAM的辅助索引和主索引没有多大区别。
- 聚簇索引
![upload successful](/images/pasted-15.png)
- 非聚簇索引
![upload successful](/images/pasted-17.png)
- 聚集索引这种实现方式使得按主键的搜索十分高效，但是辅助索引搜索需要检索两遍索引：首先检索辅助索引获得主键，然后用主键到主索引中检索获得记录。


https://github.com/julycoding/The-Art-Of-Programming-By-July/blob/master/ebook/zh/03.02.md