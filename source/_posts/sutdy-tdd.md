title: java测试驱动开发-读书笔记
date: 2018-06-21 09:58:16
tags:
categories:
---
# 代码地址:
https://bitbucket.org/vfarcic/


# 概念
TDD 有广义和狭义之分，常说的是狭义的 TDD，也就是 UTDD（Unit Test Driven Development）。广义的 TDD 是 ATDD（Acceptance Test Driven Development），包括 BDD（Behavior Driven Development）和 Consumer-Driven Contracts Development 等。
本文所说的 TDD 指狭义上的 TDD，也就是「单元测试驱动开发」。


# 对比
## 传统编码方式

- 需求分析，想不清楚细节，管他呢，先开始写
- 发现需求细节不明确，去跟业务人员确认
- 确认好几次终于写完所有逻辑
- 运行起来测试一下，靠，果然不工作，调试
- 调试好久终于工作了
- 转测试，QA 测出 bug，debug， 打补丁
- 终于，代码可以工作了
- 一看代码烂的像坨屎，不敢动，动了还得手工测试，还得让 QA 测试，还得加班...


## TDD 编码方式

- 先分解任务，分离关注点（后面有演示）
- 列 Example，用实例化需求，澄清需求细节
- 写测试，只关注需求，程序的输入输出，不关心中间过程
- 写实现，不考虑别的需求，用最简单的方式满足当前这个小需求即可
- 重构，用手法消除代码里的坏味道
- 写完，手动测试一下，基本没什么问题，有问题补个用例，修复
- 转测试，小问题，补用例，修复
- 代码整洁且用例齐全，信心满满地提交

# 基本流程
TDD 的基本流程是：红，绿，重构。
更详细的流程是：

- 写一个测试用例
- 运行测试
- 写刚好能让测试通过的实现
- 运行测试
- 识别坏味道，用手法修改代码
- 运行测试

# 为什么很多人做 TDD 都做不起来？
## 不会合理拆分任务
TDD 之前要拆分任务，把一个大需求拆成多个小需求。
也可以拆出多个函数来。

## 不会写测试
什么是有效的单元测试，有很多人写测试，连到底在测什么都不清楚，也可能连断言都没有，通过控制台输出，肉眼对比来验证。
好的单元测试应该符合几条原则：

- 简单，只测试一个需求
- 符合 Given-When-Then 格式
- 速度快
- 包含断言
- 可以重复执行

## 不会写刚好的实现
很多人写实现的时候无法专注当前需求，一不小心就把其他需求也实现了，就破坏了节奏感。
实现的时候不会小步快走。

## 不会重构
不懂什么是 Clean Code，看不出 Smell，没有及时重构，等想要重构时已经难以下手了。
不知道用合适的「手法」消除 Smell。

## 基础设施
对于特定技术栈，没有把单元测试基础设施搭建好，导致写测试时无法专注在测试用例上。



# 单元测试+模拟
## 第四章 什么事单元测试

## 第五章 难以测试,代表设计不佳

## 第六章 模拟 消除外部依赖
测试使用调用了依赖的对象的某个方法

# 集成测试(行为驱动测试)+vargant
JBhave





# 相关讨论
https://www.zhihu.com/question/27081528

# 参考
https://www.jianshu.com/p/62f16cd4fef3


