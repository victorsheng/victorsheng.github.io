<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="zh-CN">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.3.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="victor的个人博客,作为一枚后端开发工程师,写本博客目的,旨在记录自己在工作生活中的点点滴滴,形成自己的知识体系">
<meta property="og:type" content="website">
<meta property="og:title" content="Victor的博客">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Victor的博客">
<meta property="og:description" content="victor的个人博客,作为一枚后端开发工程师,写本博客目的,旨在记录自己在工作生活中的点点滴滴,形成自己的知识体系">
<meta property="og:locale" content="zh-CN">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Victor的博客">
<meta name="twitter:description" content="victor的个人博客,作为一枚后端开发工程师,写本博客目的,旨在记录自己在工作生活中的点点滴滴,形成自己的知识体系">






  <link rel="canonical" href="http://yoursite.com/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Victor的博客</title>
  






  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "https://hm.baidu.com/hm.js?2342180055c7117a644c0e88269f1028";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>




  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Victor的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-sitemap">
    <a href="/sitemap.xml" rel="section">
      <i class="menu-item-icon fa fa-fw fa-sitemap"></i> <br />站点地图</a>
  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />搜索</a>
        </li>
      
    </ul>
  

  
    

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/10/安全/OpenSSL-SelfBuild-CA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Victor">
      <meta itemprop="description" content="victor的个人博客,作为一枚后端开发工程师,写本博客目的,旨在记录自己在工作生活中的点点滴滴,形成自己的知识体系">
      <meta itemprop="image" content="/images/tennis.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Victor的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/10/安全/OpenSSL-SelfBuild-CA/" itemprop="url">
                  使用OpenSSL自建CA并颁发SSL证书
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-10 14:58:32 / 修改时间：19:51:49" itemprop="dateCreated datePublished" datetime="2018-07-10T14:58:32+08:00">2018-07-10</time>
            

            
              

              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/10/安全/OpenSSL-SelfBuild-CA/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/07/10/安全/OpenSSL-SelfBuild-CA/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/07/10/安全/OpenSSL-SelfBuild-CA/" class="leancloud_visitors" data-flag-title="使用OpenSSL自建CA并颁发SSL证书">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="申请-X-509-CA-证书的流程"><a href="#申请-X-509-CA-证书的流程" class="headerlink" title="申请 X.509 CA 证书的流程"></a>申请 X.509 CA 证书的流程</h1><ol>
<li>用户先在本地通过 RSA 生成一对公钥 Kp 和密钥 Ks，</li>
<li>然后，用户在本地生成一张 CSR 证书，既 Certificate Signing Request<ul>
<li>需要填写诸如你的域名，公司名，部门名称，城市名，地区名，国家名，电子邮件等等证明你身份的信息，</li>
<li>添加用户公钥 Kp</li>
<li>将上述信息通过 Ks 进行签名得到 Scsr</li>
<li>将上述的签名 Scsr、Kp 以及身份信息合并成为一张 CSR 证书 ;</li>
<li>TODO: 需要合并 Scsr 吗？这个还需要进一步求证……</li>
</ul>
</li>
<li>申请者通过向 CA 中心或者 RA 中心提交 CSR 证书，申请 X.509 证书；</li>
<li>CA 中心用它的密钥 Ks(ca) 对用户提交的 CSR 证书进行签名，将签名和 CSR 合并生成一张 X.509 证书；详细的签名过程，<ul>
<li>CA 中心通过签名算法(比如 MD5)对 CSR 证书进行签名；</li>
<li>然后通过 Ks(ca) 对上述的签名进行加密，得到加密后的签名；</li>
<li>最后，将加密后的签名和用户提交的 CSR 合并成为一张 X.509 证书；</li>
</ul>
</li>
<li>最后将该 X.509 证书 颁发给用户；</li>
</ol>
<h1 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h1><h2 id="建立-CA"><a href="#建立-CA" class="headerlink" title="建立 CA"></a>建立 CA</h2><h2 id="配置openssl-cnf"><a href="#配置openssl-cnf" class="headerlink" title="配置openssl.cnf"></a>配置openssl.cnf</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp /etc/ssl/openssl.cnf ~/ssl/openssl.cnf</span><br></pre></td></tr></table></figure>
<p>理论上是可以拷贝过来的.可是mac中的配置过于简单且不完成,所以我们从github中进行下载</p>
<p><a href="https://github.com/openssl/openssl/blob/master/apps/openssl.cnf" target="_blank" rel="noopener">https://github.com/openssl/openssl/blob/master/apps/openssl.cnf</a></p>
<p>修改变量:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dir         = /Users/victor/demoCA           # Where everything is kept</span><br></pre></td></tr></table></figure></p>
<h2 id="为用户颁发证书"><a href="#为用户颁发证书" class="headerlink" title="为用户颁发证书"></a>为用户颁发证书</h2><h3 id="密钥生成"><a href="#密钥生成" class="headerlink" title="密钥生成"></a>密钥生成</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openssl genrsa -out nginx.key 2048</span><br></pre></td></tr></table></figure>
<h3 id="生成证书签署请求"><a href="#生成证书签署请求" class="headerlink" title="生成证书签署请求"></a>生成证书签署请求</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">openssl req -new -key nginx.key -out nginx.csr -config=demoCA/openssl.cnf</span><br><span class="line"></span><br><span class="line">输入信息</span><br><span class="line">...</span><br><span class="line">Country Name (2 letter code) [AU]:CN</span><br><span class="line">State or Province Name (full name) [Some-State]:GD</span><br><span class="line">Locality Name (eg, city) []:SZ</span><br><span class="line">Organization Name (eg, company) [Internet Widgits Pty Ltd]:COMPANY</span><br><span class="line">Organizational Unit Name (eg, section) []:IT_SECTION</span><br><span class="line">Common Name (e.g. server FQDN or YOUR name) []:your.domain.com</span><br><span class="line">Email Address []:</span><br><span class="line"></span><br><span class="line">Please enter the following &apos;extra&apos; attributes</span><br><span class="line">to be sent with your certificate request</span><br><span class="line">A challenge password []:</span><br><span class="line">An optional company name []:</span><br><span class="line">...</span><br><span class="line">输入至少4位的密码</span><br></pre></td></tr></table></figure>
<h3 id="签署证书"><a href="#签署证书" class="headerlink" title="签署证书"></a>签署证书</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">openssl ca -in nginx.csr -out nginx.crt -config=demoCA/openssl.cnf</span><br><span class="line"></span><br><span class="line">确认:</span><br><span class="line">Using configuration from demoCA/openssl.cnf</span><br><span class="line">Check that the request matches the signature</span><br><span class="line">Signature ok</span><br><span class="line">Certificate Details:</span><br><span class="line">        Serial Number: 1 (0x1)</span><br><span class="line">        Validity</span><br><span class="line">            Not Before: Jul 10 06:43:19 2018 GMT</span><br><span class="line">            Not After : Jul 10 06:43:19 2019 GMT</span><br><span class="line">        Subject:</span><br><span class="line">            countryName               = cn</span><br><span class="line">            stateOrProvinceName       = cn</span><br><span class="line">            organizationName          = cn</span><br><span class="line">            organizationalUnitName    = cn</span><br><span class="line">            commonName                = www.td.com</span><br><span class="line">            emailAddress              = td@qq.com</span><br><span class="line">        X509v3 extensions:</span><br><span class="line">            X509v3 Basic Constraints:</span><br><span class="line">                CA:FALSE</span><br><span class="line">            Netscape Comment:</span><br><span class="line">                OpenSSL Generated Certificate</span><br><span class="line">            X509v3 Subject Key Identifier:</span><br><span class="line">                A0:FF:94:8C:85:19:2C:1F:B1:21:6F:41:72:D5:2F:BC:93:F7:A1:72</span><br><span class="line">            X509v3 Authority Key Identifier:</span><br><span class="line">                DirName:/C=cn/ST=cn/L=cn/O=cn/OU=cn/CN=cn/emailAddress=cn</span><br><span class="line">                serial:F1:EC:A3:82:A6:C1:21:92</span><br><span class="line"></span><br><span class="line">Certificate is to be certified until Jul 10 06:43:19 2019 GMT (365 days)</span><br><span class="line">Sign the certificate? [y/n]</span><br></pre></td></tr></table></figure>
<h2 id="查看证书"><a href="#查看证书" class="headerlink" title="查看证书"></a>查看证书</h2><p><img src="/images/pasted-212.png" alt="upload successful"></p>
<h2 id="把RSA私钥转换成PKCS8格式-pem和der格式"><a href="#把RSA私钥转换成PKCS8格式-pem和der格式" class="headerlink" title="把RSA私钥转换成PKCS8格式(pem和der格式)"></a>把RSA私钥转换成PKCS8格式(pem和der格式)</h2><p><code>openssl pkcs8 -topk8 -inform PEM -in nginx.key -outform PEM -nocrypt -out nginx_private_key.pem</code><br><code>openssl pkcs8 -topk8 -inform PEM -outform DER -in nginx.key -out nginx_private_key.der -nocrypt</code></p>
<h2 id="生成RSA公钥-pem和der格式"><a href="#生成RSA公钥-pem和der格式" class="headerlink" title="生成RSA公钥(pem和der格式)"></a>生成RSA公钥(pem和der格式)</h2><p><code>openssl rsa -in nginx.key -pubout -out nginx_public_key.pem</code><br><code>openssl rsa -in nginx.key -pubout -outform DER -out nginx_public_key.der</code></p>
<h1 id="其他证书操作"><a href="#其他证书操作" class="headerlink" title="其他证书操作"></a>其他证书操作</h1><ul>
<li>查看证书的内容：<code>openssl x509 -in cert.pem -text -noout</code></li>
<li>吊销证书：<code>openssl ca -revoke cert.pem -config openssl.cnf</code></li>
<li>证书吊销列表：<code>openssl ca -gencrl -out cacert.crl -config openssl.cnf</code></li>
<li>查看列表内容：<code>openssl crl -in cacert.crl -text -noout</code></li>
</ul>
<h1 id="密钥-公钥格式"><a href="#密钥-公钥格式" class="headerlink" title="密钥/公钥格式"></a>密钥/公钥格式</h1><h2 id="PEM"><a href="#PEM" class="headerlink" title="PEM"></a>PEM</h2><p>DER 是密钥的二进制表述格式；</p>
<p><a href="http://fileformats.archiveteam.org/wiki/DER" target="_blank" rel="noopener">http://fileformats.archiveteam.org/wiki/DER</a></p>
<blockquote>
<p>Distinguished Encoding Rules (DER) is a binary serialization of ASN.1 format. It is often used for cryptographic data such as certificates, but has other uses.</p>
</blockquote>
<p>很明显，DER 就是 ASN.1 的二进制格式；</p>
<h2 id="DER"><a href="#DER" class="headerlink" title="DER"></a>DER</h2><p>PEM 格式既是对 DER 编码转码为 Base64 字符格式；通过解码，将会还原为 DER 格式；</p>
<blockquote>
<p>A PEM file is plain text. It contain one or more objects, such as certificates or keys, which may not all be the same type. Each object is delimited by lines similar to “—–BEGIN …—–” and “—–END …—–”. Data that is not between such lines is ignored, and is sometimes used for comments, or for a human-readable dump of the encoded data.</p>
<p>Following the “BEGIN” and “END” keywords is a name (such as “CERTIFICATE”) that can be used as an identifier for the type of object.</p>
<p>The data between the delimiter lines starts with an optional email-like header section, followed by base64-encoded payload data. After decoding, the payload data is in DER format.</p>
</blockquote>
<p>总体而言，PEM 是明文格式，可以包含证书或者是密钥；其内容通常是以类似 “—–BEGIN …—–” 开头 “—–END …—–” 为结尾的这样的格式进行展示的；后续内容也描述到，PEM 格式的内容是 Base64 格式；通过解码，转换为 DER 格式，也就是说，PEM 是建立在 DER 编码之上的；</p>
<h1 id="PKCS"><a href="#PKCS" class="headerlink" title="PKCS"></a>PKCS</h1><h2 id="PKCS-1-公钥和密钥的格式标准（通过-ASN-1-的格式标准来定义并明文展示）"><a href="#PKCS-1-公钥和密钥的格式标准（通过-ASN-1-的格式标准来定义并明文展示）" class="headerlink" title="PKCS 1 公钥和密钥的格式标准（通过 ASN.1 的格式标准来定义并明文展示）"></a>PKCS 1 公钥和密钥的格式标准（通过 ASN.1 的格式标准来定义并明文展示）</h2><ul>
<li>以及为 RSA 进行加密、解密，生成和验证签名等操作定义了基本的算法和编码/补零(padding)的方案</li>
<li>PCKS #1 定义的都是明文的格式</li>
</ul>
<p>ASN.1 是一种接口描述性语言，该语言定义了能够进行跨平台、序列化和反序列化的数据格式；它被广泛的用于电子通讯以及计算机网络中，特别是用在密码学的领域；由此可知，ASN.1 定义了一种专用于密码学领域的一种可以进行序列化和反序列化的数据格式；</p>
<h3 id="公钥"><a href="#公钥" class="headerlink" title="公钥"></a>公钥</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">RSAPublicKey ::= SEQUENCE &#123;</span><br><span class="line">    modulus           INTEGER,  -- n</span><br><span class="line">    publicExponent    INTEGER   -- e</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="私钥"><a href="#私钥" class="headerlink" title="私钥"></a>私钥</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">RSAPrivateKey ::= SEQUENCE &#123;</span><br><span class="line">    version           Version,</span><br><span class="line">    modulus           INTEGER,  -- n</span><br><span class="line">    publicExponent    INTEGER,  -- e</span><br><span class="line">    privateExponent   INTEGER,  -- d</span><br><span class="line">    prime1            INTEGER,  -- p</span><br><span class="line">    prime2            INTEGER,  -- q</span><br><span class="line">    exponent1         INTEGER,  -- d mod (p-1)</span><br><span class="line">    exponent2         INTEGER,  -- d mod (q-1)</span><br><span class="line">    coefficient       INTEGER,  -- (inverse of q) mod p</span><br><span class="line">    otherPrimeInfos   OtherPrimeInfos OPTIONAL</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="PKCS-7-被加密消息的格式标准"><a href="#PKCS-7-被加密消息的格式标准" class="headerlink" title="PKCS 7 被加密消息的格式标准"></a>PKCS 7 被加密消息的格式标准</h2><ul>
<li>PKCS 7 通常在一个 PKI 中用来签名或者加密信息，也通常用于证书的传递</li>
<li>PKCS 7 主要定义了消息的加密语法标准</li>
</ul>
<p>CMS 用来描述数据加密的一种封装语法；CMS 可以用于支持多种多样的证书管理实现，比如 PKIX (X.509 中的公钥管理的内部实现)；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">ContentInfo ::= SEQUENCE &#123;</span><br><span class="line">  contentType ContentType,</span><br><span class="line">  content [0] EXPLICIT ANY DEFINED BY contentType &#125;</span><br><span class="line"></span><br><span class="line">ContentType ::= OBJECT IDENTIFIER</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SignedData ::= SEQUENCE &#123;</span><br><span class="line">  version CMSVersion,</span><br><span class="line">  digestAlgorithms DigestAlgorithmIdentifiers,</span><br><span class="line">  encapContentInfo EncapsulatedContentInfo,</span><br><span class="line">  certificates [0] IMPLICIT CertificateSet OPTIONAL,</span><br><span class="line">  crls [1] IMPLICIT RevocationInfoChoices OPTIONAL,</span><br><span class="line">  signerInfos SignerInfos &#125;</span><br><span class="line"></span><br><span class="line">DigestAlgorithmIdentifiers ::= SET OF DigestAlgorithmIdentifier</span><br><span class="line"></span><br><span class="line">SignerInfos ::= SET OF SignerInfo</span><br><span class="line"></span><br><span class="line">EncapsulatedContentInfo ::= SEQUENCE &#123;</span><br><span class="line">  eContentType ContentType,</span><br><span class="line">  eContent [0] EXPLICIT OCTET STRING OPTIONAL &#125;</span><br><span class="line"></span><br><span class="line">SignerInfo ::= SEQUENCE &#123;</span><br><span class="line">  version CMSVersion,</span><br><span class="line">  sid SignerIdentifier,</span><br><span class="line">  digestAlgorithm DigestAlgorithmIdentifier,</span><br><span class="line">  signedAttrs [0] IMPLICIT SignedAttributes OPTIONAL,</span><br><span class="line">  signatureAlgorithm SignatureAlgorithmIdentifier,</span><br><span class="line">  signature SignatureValue,</span><br><span class="line">  unsignedAttrs [1] IMPLICIT UnsignedAttributes OPTIONAL &#125;</span><br><span class="line"></span><br><span class="line">SignerIdentifier ::= CHOICE &#123;</span><br><span class="line">  issuerAndSerialNumber IssuerAndSerialNumber,</span><br><span class="line">  subjectKeyIdentifier [0] SubjectKeyIdentifier &#125;</span><br><span class="line"></span><br><span class="line">SignedAttributes ::= SET SIZE (1..MAX) OF Attribute</span><br><span class="line"></span><br><span class="line">UnsignedAttributes ::= SET SIZE (1..MAX) OF Attribute</span><br><span class="line"></span><br><span class="line">Attribute ::= SEQUENCE &#123;</span><br><span class="line">  attrType OBJECT IDENTIFIER,</span><br><span class="line">  attrValues SET OF AttributeValue &#125;</span><br><span class="line"></span><br><span class="line">AttributeValue ::= ANY</span><br><span class="line"></span><br><span class="line">SignatureValue ::= OCTET STRING</span><br><span class="line"></span><br><span class="line">EnvelopedData ::= SEQUENCE &#123;</span><br><span class="line">  version CMSVersion,</span><br><span class="line">  originatorInfo [0] IMPLICIT OriginatorInfo OPTIONAL,</span><br><span class="line">  recipientInfos RecipientInfos,</span><br><span class="line">  encryptedContentInfo EncryptedContentInfo,</span><br><span class="line">  unprotectedAttrs [1] IMPLICIT UnprotectedAttributes OPTIONAL &#125;</span><br></pre></td></tr></table></figure>
<p>可见，PKCS#7 定义完整的一整套的用于加密数据，签名，签名者，加密算法等等一系列信息；由此，奠定了其作为 PKI 的基础；</p>
<h2 id="PKCS-8-私钥信息格式标准"><a href="#PKCS-8-私钥信息格式标准" class="headerlink" title="PKCS 8 私钥信息格式标准"></a>PKCS 8 私钥信息格式标准</h2><p>包含了两个部分，private key 的原始格式 private key info 和 private key 的加密格式 encrypted private key info；</p>
<p>可以看到，PKCS #8 在原来私钥的格式上做了一层抽象封装，这样使得它可以兼容任何的私钥格式；使得 PKCS 的私钥标准可以使用到任何加密算法，这个同 PKCS#1 中定义的 RSA 私钥语法是不同的，PKCS #1 定义的只是特定的 RSA 私钥的语法格式；</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://segmentfault.com/a/1190000002569859" target="_blank" rel="noopener">https://segmentfault.com/a/1190000002569859</a><br><a href="https://deepzz.com/post/based-on-openssl-privateCA-issuer-cert.html" target="_blank" rel="noopener">https://deepzz.com/post/based-on-openssl-privateCA-issuer-cert.html</a><br><a href="https://yq.aliyun.com/articles/47314" target="_blank" rel="noopener">https://yq.aliyun.com/articles/47314</a><br><a href="https://docs.azure.cn/zh-cn/articles/azure-operations-guide/application-gateway/aog-application-gateway-howto-create-self-signed-cert-via-openssl" target="_blank" rel="noopener">https://docs.azure.cn/zh-cn/articles/azure-operations-guide/application-gateway/aog-application-gateway-howto-create-self-signed-cert-via-openssl</a></p>
<p><a href="http://www.shangyang.me/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E4%B8%8E%E6%8A%80%E6%9C%AF/%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86/RSA/" target="_blank" rel="noopener">http://www.shangyang.me/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6%E4%B8%8E%E6%8A%80%E6%9C%AF/%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86/RSA/</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/07/carreer-think/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Victor">
      <meta itemprop="description" content="victor的个人博客,作为一枚后端开发工程师,写本博客目的,旨在记录自己在工作生活中的点点滴滴,形成自己的知识体系">
      <meta itemprop="image" content="/images/tennis.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Victor的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/07/carreer-think/" itemprop="url">
                  职业规划
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-07 21:21:40 / 修改时间：21:21:42" itemprop="dateCreated datePublished" datetime="2018-07-07T21:21:40+08:00">2018-07-07</time>
            

            
              

              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/07/carreer-think/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/07/07/carreer-think/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/07/07/carreer-think/" class="leancloud_visitors" data-flag-title="职业规划">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ol>
<li>管理好自己的时间，有时间才能学习；</li>
<li>每一次工作任务，不要放弃每一个技术细节。问问自己：是否知其然且知其所以然？</li>
<li>阶段性的做目标回顾、总结，找一些身边的人聊聊，交换方案；</li>
</ol>
<hr>
<p>大家都会想到专业技术、学习能力、创新能力等，用阿里的一句话总结就是实现客户价值的能力：知道做什么（What）、怎么做（How）。</p>
<ol>
<li>分析分解业务，搞明白业务真正需要的是什么，并不断 Check 和完善 What；</li>
<li>用什么来实现，每一种技术方案的优缺点是什么，每一种技术的边界条件在哪里，限制是什么；预判业务趋势是什么，出现拐点怎么来解决；需要什么样的人和团队来做，怎么推动和协调团队成员完成目标；以及如何验证结果和最终效果。<br>综上，从架构师角度理解就是“系统化分析和思考”和“知其然知其所以然”。</li>
</ol>
<hr>
<p>对技术系统变革，大家通常都会用“飞行中的飞机换引擎”来类比，即每次切换即使新的架构设想很完美，但也必须充分考虑新老系统切换的每一步实施方案是否可行、可控。</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/07/jvm-close/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Victor">
      <meta itemprop="description" content="victor的个人博客,作为一枚后端开发工程师,写本博客目的,旨在记录自己在工作生活中的点点滴滴,形成自己的知识体系">
      <meta itemprop="image" content="/images/tennis.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Victor的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/07/jvm-close/" itemprop="url">
                  jvm优雅停机
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-07 21:18:52" itemprop="dateCreated datePublished" datetime="2018-07-07T21:18:52+08:00">2018-07-07</time>
            

            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/07/jvm-close/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/07/07/jvm-close/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/07/07/jvm-close/" class="leancloud_visitors" data-flag-title="jvm优雅停机">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Java有两种Thread：“守护线程Daemon”与“用户线程User”。<br>用户线程：Java虚拟机在它所有非守护线程已经离开后自动离开。<br>守护线程：守护线程则是用来服务用户线程的，如果没有其他用户线程在运行，那么就没有可服务对象，也就没有理由继续下去。</p>
<p>1.将应用自己创建的线程、timer、scheduler这类的资源设为守护线程（daemon）。setDaemon(boolean on)方法可以方便的设置线程的Daemon模式，true为Daemon模式，false为User模式。<br>2.自己管理非守护线程的生命周期，当容器停止时手工释放资源。比如你可以在 Servlet 或 ServletContextListener 的 init 方法中初始化资源，在 destroy 方法中释放资源。</p>
<h1 id="只有用户进程全部关闭后-才会执行shutdownhook-错误"><a href="#只有用户进程全部关闭后-才会执行shutdownhook-错误" class="headerlink" title="只有用户进程全部关闭后,才会执行shutdownhook(错误)"></a>只有用户进程全部关闭后,才会执行shutdownhook(错误)</h1><p><a href="http://810364804.iteye.com/blog/2119572" target="_blank" rel="noopener">http://810364804.iteye.com/blog/2119572</a></p>
<h1 id="区别-是在正常退出的情境下-not-被kill"><a href="#区别-是在正常退出的情境下-not-被kill" class="headerlink" title="区别(是在正常退出的情境下,not 被kill )"></a>区别(是在正常退出的情境下,not 被kill )</h1><p>守护线程与普通用户线程的区别是：java程序会在所有用户线程都执行完了才结束退出，即使主线程执行完了只要还有用户线程执行程序就在运行。但是如果其他用户线程全部执行完了守护线程如果没执行完的话它会自动被jvm终止，然后结束程序。</p>
<h2 id="主线程退出不会影响其他线程-只要用户线程还在执行"><a href="#主线程退出不会影响其他线程-只要用户线程还在执行" class="headerlink" title="主线程退出不会影响其他线程,只要用户线程还在执行"></a>主线程退出不会影响其他线程,只要用户线程还在执行</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">package com.example.demo.exist;</span><br><span class="line"></span><br><span class="line">public class ParentTest &#123;</span><br><span class="line"></span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    System.out.println(&quot;parent thread begin &quot;);</span><br><span class="line"></span><br><span class="line">    ChildThread t1 = new ChildThread(&quot;thread1&quot;);</span><br><span class="line">    ChildThread t2 = new ChildThread(&quot;thread2&quot;);</span><br><span class="line">    t1.start();</span><br><span class="line">    t2.start();</span><br><span class="line"></span><br><span class="line">    System.out.println(&quot;parent thread over &quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class ChildThread extends Thread &#123;</span><br><span class="line"></span><br><span class="line">  private String name = null;</span><br><span class="line"></span><br><span class="line">  public ChildThread(String name) &#123;</span><br><span class="line">    this.name = name;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  public void run() &#123;</span><br><span class="line">    while (true) &#123;</span><br><span class="line">      System.out.println(this.name + &quot;--child thead begin&quot;);</span><br><span class="line"></span><br><span class="line">      try &#123;</span><br><span class="line">        Thread.sleep(500);</span><br><span class="line">      &#125; catch (InterruptedException e) &#123;</span><br><span class="line">        System.out.println(e);</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      System.out.println(this.name + &quot;--child thead over&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="谁来处理关闭信号呢"><a href="#谁来处理关闭信号呢" class="headerlink" title="谁来处理关闭信号呢??"></a>谁来处理关闭信号呢??</h1>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/07/charset/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Victor">
      <meta itemprop="description" content="victor的个人博客,作为一枚后端开发工程师,写本博客目的,旨在记录自己在工作生活中的点点滴滴,形成自己的知识体系">
      <meta itemprop="image" content="/images/tennis.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Victor的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/07/charset/" itemprop="url">
                  字符集-学习总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-07 07:32:30 / 修改时间：10:56:50" itemprop="dateCreated datePublished" datetime="2018-07-07T07:32:30+08:00">2018-07-07</time>
            

            
              

              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/07/charset/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/07/07/charset/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/07/07/charset/" class="leancloud_visitors" data-flag-title="字符集-学习总结">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h1><p>“字节”是一个8位的物理存贮单元，而“字符”则是一个文化相关的符号。</p>
<h1 id="ASCII-1字节"><a href="#ASCII-1字节" class="headerlink" title="ASCII(1字节)"></a>ASCII(1字节)</h1><p>（American Standard Code for Information Interchange，美国信息互换标准代码）。当时世界上所有的计算机都用同样的ASCII方案来保存英文文字。</p>
<p>最早:ASCII编码:7位的<br>后来用 127号之后的空位来表示这些新的字母、符号，还加入了很多画表格时需要用下到的横线、竖线、交叉等形状，一直把序号编到了最后一个状态255。从128 到255这一页的字符集被称”扩展字符集“。</p>
<h1 id="iso-8859-1"><a href="#iso-8859-1" class="headerlink" title="iso 8859-1"></a>iso 8859-1</h1><p>编码是单字节编码，向下兼容ASCII，是许多欧洲国家使用的编码标准。其编码范围是0x00-0xFF，0x00-0x7F之间完全和ASCII一致，0x80-0x9F之间是控制字符，0xA0-0xFF之间是文字符号。</p>
<h1 id="GBK-中文2字节-英文1字节"><a href="#GBK-中文2字节-英文1字节" class="headerlink" title="GBK(中文2字节,英文1字节)"></a>GBK(中文2字节,英文1字节)</h1><p>GBK是国家标准GB2312基础上扩容后兼容GB2312的标准。GBK的文字编码是用<strong>双字节</strong>来表示的，即不论中、英文字符均使用双字节来表示，为了区分中文，将其最高位都设定成1。GBK包含全部中文字符，是国家编码，通用性比UTF8差，不过UTF8占用的数据库比GBD大。<br>简体中文</p>
<p>从ASCII、GB2312到GBK，这些编码方法是向下兼容的，即同一个字符在这些方案中总是有相同的编码，后面的标准支持更多的字符。在这些编码中，英文和中文可以统一地处理。区分中文编码的方法是高字节的最高位不为0。按照程序员的称呼，GB2312、GBK都属于双字节字符集 (DBCS)。</p>
<p><strong>如果这个值是大于127的，那么就认为一个双字节字符集里的字符出现了。</strong></p>
<h1 id="Unicode-”Universal-Multiple-Octet-Coded-Character-Set”，简称-UCS"><a href="#Unicode-”Universal-Multiple-Octet-Coded-Character-Set”，简称-UCS" class="headerlink" title="Unicode(”Universal Multiple-Octet Coded Character Set”，简称 UCS)"></a>Unicode(”Universal Multiple-Octet Coded Character Set”，简称 UCS)</h1><p>Unicode也是一种字符编码方法，不过它是由国际组织设计，可以容纳全世界所有语言文字的编码方案。</p>
<p>Unicode只与ASCII兼容（更准确地说，是与ISO-8859-1兼容）</p>
<p>由于”半角”英文符号只需要用到低8位，所以其高8位永远是0，因此这种大气的方案在保存英文文本时会多浪费一倍的空间。</p>
<p>Unicode 当然是一个很大的集合，现在的规模可以容纳100多万个符号。每个符号的编码都不一样，比如，U+0639表示阿拉伯字母Ain，U+0041表示英语的大写字母A，U+4E25表示汉字严。具体的符号对应表，可以查询unicode.org，或者专门的汉字对应表。</p>
<p><a href="http://www.chi2ko.com/tool/CJK.htm" target="_blank" rel="noopener">http://www.chi2ko.com/tool/CJK.htm</a></p>
<p><strong>需要注意的是，Unicode 只是一个符号集，它只规定了符号的二进制代码，却没有规定这个二进制代码应该如何存储。</strong></p>
<h2 id="Unicode-的问题"><a href="#Unicode-的问题" class="headerlink" title="Unicode 的问题"></a>Unicode 的问题</h2><p>需要注意的是，Unicode 只是一个符号集，它只规定了符号的二进制代码，却没有规定这个二进制代码应该如何存储。</p>
<p>比如，汉字严的 Unicode 是十六进制数4E25，转换成二进制数足足有15位（100111000100101），也就是说，这个符号的表示至少需要2个字节。表示其他更大的符号，可能需要3个字节或者4个字节，甚至更多。</p>
<p>这里就有两个严重的问题，第一个问题是，如何才能区别 Unicode 和 ASCII ？计算机怎么知道三个字节表示一个符号，而不是分别表示三个符号呢？第二个问题是，我们已经知道，英文字母只用一个字节表示就够了，如果 Unicode 统一规定，每个符号用三个或四个字节表示，那么每个英文字母前都必然有二到三个字节是0，这对于存储来说是极大的浪费，文本文件的大小会因此大出二三倍，这是无法接受的。</p>
<p><strong>utf-8,utf-16,utf-32是unicode码一种实现形式，都是属于unicode编码。</strong></p>
<h1 id="UTF-8-1-4个字节表示一个符号"><a href="#UTF-8-1-4个字节表示一个符号" class="headerlink" title="UTF-8(1~4个字节表示一个符号)"></a>UTF-8(1~4个字节表示一个符号)</h1><p>（8-bit Unicode Transformation Format）的简称</p>
<p>UTF-8 最大的一个特点，就是它是一种变长的编码方式。它可以使用1~4个字节表示一个符号，根据不同的符号而变化字节长度。</p>
<p>UTF-8 的编码规则很简单，只有二条：</p>
<p>1）对于单字节的符号，字节的第一位设为0，后面7位为这个符号的 Unicode 码。因此对于英语字母，UTF-8 编码和 ASCII 码是相同的。</p>
<p>2）对于n字节的符号（n &gt; 1），第一个字节的前n位都设为1，第n + 1位设为0，后面字节的前两位一律设为10。剩下的没有提及的二进制位，全部为这个符号的 Unicode 码。</p>
<p>下表总结了编码规则，字母x表示可用编码的位。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Unicode符号范围     |        UTF-8编码方式</span><br><span class="line">(十六进制)        |              （二进制）</span><br><span class="line">----------------------+---------------------------------------------</span><br><span class="line">0000 0000-0000 007F | 0xxxxxxx</span><br><span class="line">0000 0080-0000 07FF | 110xxxxx 10xxxxxx</span><br><span class="line">0000 0800-0000 FFFF | 1110xxxx 10xxxxxx 10xxxxxx</span><br><span class="line">0001 0000-0010 FFFF | 11110xxx 10xxxxxx 10xxxxxx 10xxxxxx</span><br></pre></td></tr></table></figure>
<p>跟据上表，解读 UTF-8 编码非常简单。如果一个字节的第一位是0，则这个字节单独就是一个字符；如果第一位是1，则连续有多少个1，就表示当前字符占用多少个字节。</p>
<p>下面，还是以汉字严为例，演示如何实现 UTF-8 编码。</p>
<p>严的 Unicode 是4E25（100111000100101），根据上表，可以发现4E25处在第三行的范围内（0000 0800 - 0000 FFFF），因此严的 UTF-8 编码需要三个字节，即格式是1110xxxx 10xxxxxx 10xxxxxx。然后，从严的最后一个二进制位开始，依次从后向前填入格式中的x，多出的位补0。这样就得到了，严的 UTF-8 编码是11100100 10111000 10100101，转换成十六进制就是E4B8A5。</p>
<hr>
<p>UTF-8：Unicode TransformationFormat-8bit，允许含BOM，但通常不含BOM。是用以解决国际上字符的一种多字节编码，<strong>它对英文使用8位（即一个字节），中文使用24为（三个字节）来编码</strong>。<br>UTF-8包含全世界所有国家需要用到的字符，是国际编码，通用性强。UTF-8编码的文字可以在各国支持UTF8字符集的浏览器上显示。如，如果是UTF8编码，则在外国人的英文IE上也能显示中文，他们无需下载IE的中文语言支持包。 </p>
<p><a href="https://zh.wikipedia.org/wiki/UTF-8" target="_blank" rel="noopener">https://zh.wikipedia.org/wiki/UTF-8</a></p>
<h1 id="bom-Byte-Order-Mark"><a href="#bom-Byte-Order-Mark" class="headerlink" title="bom(Byte Order Mark)"></a>bom(Byte Order Mark)</h1><p>大端法（Big endian）:高位在前<br>小端法（Little endian）:低位在前</p>
<p>BOM=Byte Order Mark，翻译过来就是“字节顺序标识”<br>自然地，这里所谓的字节顺序其实就是指使用了哪种端法。</p>
<ul>
<li>UTF-16 BE（Big Endian）的BOM是：FE FF</li>
<li>UTF-16 LE（Little Endian）的BOM是：FF FE</li>
<li>UTF-8的BOM是：EF BB BF</li>
</ul>
<p>UTF-8也不存在所谓的大小端两种情况，统一为大端法</p>
<p><a href="https://my.oschina.net/goldenshaw/blog/323248" target="_blank" rel="noopener">https://my.oschina.net/goldenshaw/blog/323248</a></p>
<h1 id="GBK和UTF-8互转尾部乱码问题分析"><a href="#GBK和UTF-8互转尾部乱码问题分析" class="headerlink" title="GBK和UTF-8互转尾部乱码问题分析"></a>GBK和UTF-8互转尾部乱码问题分析</h1><p><a href="https://blog.csdn.net/54powerman/article/details/77575656" target="_blank" rel="noopener">https://blog.csdn.net/54powerman/article/details/77575656</a></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="http://frontenddev.org/link/ascii-unicode-gbk-and-utf-8-character-encoding-is-the-difference-between-contact.html" target="_blank" rel="noopener">http://frontenddev.org/link/ascii-unicode-gbk-and-utf-8-character-encoding-is-the-difference-between-contact.html</a></p>
<p><a href="http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html" target="_blank" rel="noopener">http://www.ruanyifeng.com/blog/2007/10/ascii_unicode_and_utf-8.html</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/06/how-ok-httpclient-release-tcp-connection/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Victor">
      <meta itemprop="description" content="victor的个人博客,作为一枚后端开发工程师,写本博客目的,旨在记录自己在工作生活中的点点滴滴,形成自己的知识体系">
      <meta itemprop="image" content="/images/tennis.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Victor的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/06/how-ok-httpclient-release-tcp-connection/" itemprop="url">
                  how-ok-httpclient-release-tcp-connection
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-06 06:55:04" itemprop="dateCreated datePublished" datetime="2018-07-06T06:55:04+08:00">2018-07-06</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-07-07 21:19:52" itemprop="dateModified" datetime="2018-07-07T21:19:52+08:00">2018-07-07</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/06/how-ok-httpclient-release-tcp-connection/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/07/06/how-ok-httpclient-release-tcp-connection/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/07/06/how-ok-httpclient-release-tcp-connection/" class="leancloud_visitors" data-flag-title="how-ok-httpclient-release-tcp-connection">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="httpclient未close时-进行关闭"><a href="#httpclient未close时-进行关闭" class="headerlink" title="httpclient未close时,进行关闭"></a>httpclient未close时,进行关闭</h1><p>测试了main方法结束退出,和被kill -9退出的两种方式,都是发送rst</p>
<p><img src="/images/pasted-208.png" alt="upload successful"></p>
<h1 id="okhttpclient异常关闭"><a href="#okhttpclient异常关闭" class="headerlink" title="okhttpclient异常关闭"></a>okhttpclient异常关闭</h1><p><img src="/images/pasted-207.png" alt=""></p>
<h1 id="问题不知道在哪进行设置的"><a href="#问题不知道在哪进行设置的" class="headerlink" title="问题不知道在哪进行设置的"></a>问题不知道在哪进行设置的</h1>
          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/06/linux-proc-folder/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Victor">
      <meta itemprop="description" content="victor的个人博客,作为一枚后端开发工程师,写本博客目的,旨在记录自己在工作生活中的点点滴滴,形成自己的知识体系">
      <meta itemprop="image" content="/images/tennis.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Victor的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/06/linux-proc-folder/" itemprop="url">
                  linux-proc-folder
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-06 06:03:46 / 修改时间：06:28:13" itemprop="dateCreated datePublished" datetime="2018-07-06T06:03:46+08:00">2018-07-06</time>
            

            
              

              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/06/linux-proc-folder/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/07/06/linux-proc-folder/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/07/06/linux-proc-folder/" class="leancloud_visitors" data-flag-title="linux-proc-folder">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="proc目录"><a href="#proc目录" class="headerlink" title="/proc目录"></a>/proc目录</h1><ul>
<li>Linux 内核提供了一种通过 /proc 文件系统，在运行时访问内核内部数据结构、改变内核设置的机制。</li>
<li>proc文件系统是一个伪文件系统，<strong>它只存在内存当中</strong>，而不占用外存空间。</li>
<li>它以文件系统的方式为访问系统内核数据的操作提供接口。</li>
</ul>
<h2 id="子文件或子文件夹"><a href="#子文件或子文件夹" class="headerlink" title="子文件或子文件夹"></a>子文件或子文件夹</h2><p>/proc/buddyinfo 每个内存区中的每个order有多少块可用，和内存碎片问题有关</p>
<p>/proc/cmdline 启动时传递给kernel的参数信息</p>
<p>/proc/cpuinfo cpu的信息</p>
<p>/proc/crypto 内核使用的所有已安装的加密密码及细节</p>
<p>/proc/devices 已经加载的设备并分类</p>
<p>/proc/dma 已注册使用的ISA DMA频道列表</p>
<p>/proc/execdomains Linux内核当前支持的execution domains</p>
<p>/proc/fb 帧缓冲设备列表，包括数量和控制它的驱动</p>
<p>/proc/filesystems 内核当前支持的文件系统类型</p>
<p>/proc/interrupts x86架构中的每个IRQ中断数</p>
<p>/proc/iomem 每个物理设备当前在系统内存中的映射</p>
<p>/proc/ioports 一个设备的输入输出所使用的注册端口范围</p>
<p>/proc/kcore 代表系统的物理内存，存储为核心文件格式，里边显示的是字节数，等于RAM大小加上4kb</p>
<p>/proc/kmsg 记录内核生成的信息，可以通过/sbin/klogd或/bin/dmesg来处理</p>
<p>/proc/loadavg 根据过去一段时间内CPU和IO的状态得出的负载状态，与uptime命令有关</p>
<p>/proc/locks 内核锁住的文件列表</p>
<p>/proc/mdstat 多硬盘，RAID配置信息(md=multiple disks)</p>
<p>/proc/meminfo RAM使用的相关信息</p>
<p>/proc/misc 其他的主要设备(设备号为10)上注册的驱动</p>
<p>/proc/modules 所有加载到内核的模块列表</p>
<p>/proc/mounts 系统中使用的所有挂载</p>
<p>/proc/mtrr 系统使用的Memory Type Range Registers (MTRRs)</p>
<p>/proc/partitions 分区中的块分配信息</p>
<p>/proc/pci 系统中的PCI设备列表</p>
<p>/proc/slabinfo 系统中所有活动的 slab 缓存信息</p>
<p>/proc/stat 所有的CPU活动信息</p>
<p>/proc/sysrq-trigger 使用echo命令来写这个文件的时候，远程root用户可以执行大多数的系统请求关键命令，就好像在本地终端执行一样。要写入这个文件，需要把/proc/sys/kernel/sysrq不能设置为0。这个文件对root也是不可读的</p>
<p>/proc/uptime 系统已经运行了多久</p>
<p>/proc/swaps 交换空间的使用情况</p>
<p>/proc/version Linux内核版本和gcc版本</p>
<p>/proc/bus 系统总线(Bus)信息，例如pci/usb等</p>
<p>/proc/driver 驱动信息</p>
<p>/proc/fs 文件系统信息</p>
<p>/proc/ide ide设备信息</p>
<p>/proc/irq 中断请求设备信息</p>
<p>/proc/net 网卡设备信息</p>
<p>/proc/scsi scsi设备信息</p>
<p>/proc/tty tty设备信息</p>
<p>/proc/net/dev 显示网络适配器及统计信息</p>
<p>/proc/vmstat 虚拟内存统计信息</p>
<p>/proc/vmcore 内核panic时的内存映像</p>
<p>/proc/diskstats 取得磁盘信息</p>
<p>/proc/schedstat kernel调度器的统计信息</p>
<p>/proc/zoneinfo 显示内存空间的统计信息，对分析虚拟内存行为很有用</p>
<h2 id="proc目录中进程N的信息"><a href="#proc目录中进程N的信息" class="headerlink" title="/proc目录中进程N的信息"></a>/proc目录中进程N的信息</h2><p>/proc/N pid为N的进程信息</p>
<p>/proc/N/cmdline 进程启动命令</p>
<p>/proc/N/cwd 链接到进程当前工作目录</p>
<p>/proc/N/environ 进程环境变量列表</p>
<p>/proc/N/exe 链接到进程的执行命令文件</p>
<p><strong>/proc/N/fd 包含进程相关的所有的文件描述符</strong></p>
<p>/proc/N/maps 与进程相关的内存映射信息</p>
<p>/proc/N/mem 指代进程持有的内存，不可读</p>
<p>/proc/N/root 链接到进程的根目录</p>
<p>/proc/N/stat 进程的状态</p>
<p>/proc/N/statm 进程使用的内存的状态</p>
<p>/proc/N/status 进程状态信息，比stat/statm更具可读性</p>
<p>/proc/self 链接到当前正在运行的进程</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/05/java-file-linux/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Victor">
      <meta itemprop="description" content="victor的个人博客,作为一枚后端开发工程师,写本博客目的,旨在记录自己在工作生活中的点点滴滴,形成自己的知识体系">
      <meta itemprop="image" content="/images/tennis.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Victor的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/05/java-file-linux/" itemprop="url">
                  文件句柄泄漏
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-05 20:16:42" itemprop="dateCreated datePublished" datetime="2018-07-05T20:16:42+08:00">2018-07-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-07-06 05:57:47" itemprop="dateModified" datetime="2018-07-06T05:57:47+08:00">2018-07-06</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/05/java-file-linux/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/07/05/java-file-linux/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/07/05/java-file-linux/" class="leancloud_visitors" data-flag-title="文件句柄泄漏">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">public class FileHandleLeakExample &#123;</span><br><span class="line"></span><br><span class="line">  public static String readContentFromFile(String filename) &#123;</span><br><span class="line"></span><br><span class="line">    StringBuilder sb = new StringBuilder();</span><br><span class="line">    BufferedReader br = null;</span><br><span class="line">    try &#123;</span><br><span class="line">      br = new BufferedReader(new FileReader(filename));</span><br><span class="line">      String line = null;</span><br><span class="line">      while ((line = br.readLine()) != null) &#123;</span><br><span class="line">        sb.append(line).append(&quot;\n&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">      System.err.println(e.getMessage());</span><br><span class="line">      exit(1);</span><br><span class="line">    &#125; finally &#123;</span><br><span class="line">//          模拟疏忽关掉句柄的操作</span><br><span class="line">//            try &#123;</span><br><span class="line">//                br.close();</span><br><span class="line">//            &#125; catch (IOException e) &#123;</span><br><span class="line">//                e.printStackTrace();</span><br><span class="line">//            &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    return sb.toString();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    for (int j = 0; j &lt; 20; j++) &#123;</span><br><span class="line">      System.out.println(j++);</span><br><span class="line">      FileHandleLeakExample.readContentFromFile(&quot;/Users/victor/tmp/qingshu.txt&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(&quot;byte&quot;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>在System.out.println(“byte”); 打断点</li>
<li>通过jps</li>
<li>lsof -p pid 观察</li>
</ul>
<p><img src="/images/pasted-206.png" alt="upload successful"></p>
<h1 id="lsof命令"><a href="#lsof命令" class="headerlink" title="lsof命令"></a>lsof命令</h1><p>lsof（list open files）是一个列出当前系统打开文件的工具。在linux环境下，任何事物都以文件的形式存在，通过文件不仅仅可以访问常规数据，还可以访问网络连接和硬件。所以如传输控制协议 (TCP) 和用户数据报协议 (UDP) 套接字等，系统在后台都为该应用程序分配了一个文件描述符，无论这个文件的本质如何，该文件描述符为应用程序与基础操作系统之间的交互提供了通用接口。因为应用程序打开文件的描述符列表提供了大量关于这个应用程序本身的信息，因此通过lsof工具能够查看这个列表对系统监测以及排错将是很有帮助的。</p>
<h2 id="lsof打开的文件可以是："><a href="#lsof打开的文件可以是：" class="headerlink" title="lsof打开的文件可以是："></a>lsof打开的文件可以是：</h2><p>1.普通文件<br>2.目录<br>3.网络文件系统的文件<br>4.字符或设备文件<br>5.(函数)共享库<br>6.管道，命名管道<br>7.符号链接<br>8.网络文件（例如：NFS file、网络socket，unix域名socket）<br>9.还有其它类型的文件，等等</p>
<h2 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h2><p>lsof abc.txt 显示开启文件abc.txt的进程<br>lsof -c abc 显示abc进程现在打开的文件<br>lsof -c -p 1234 列出进程号为1234的进程所打开的文件<br>lsof -g gid 显示归属gid的进程情况<br>lsof +d /usr/local/ 显示目录下被进程开启的文件<br>lsof +D /usr/local/ 同上，但是会搜索目录下的目录，时间较长<br>lsof -d 4 显示使用fd为4的进程<br>lsof -i 用以显示符合条件的进程情况<br>lsof -i[46] [protocol][@hostname|hostaddr][:service|port]<br>  46 –&gt; IPv4 or IPv6<br>  protocol –&gt; TCP or UDP<br>  hostname –&gt; Internet host name<br>  hostaddr –&gt; IPv4地址<br>  service –&gt; /etc/service中的 service name (可以不止一个)<br>  port –&gt; 端口号 (可以不止一个)</p>
<h2 id="说明："><a href="#说明：" class="headerlink" title="说明："></a>说明：</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">lsof输出各列信息的意义如下：</span><br><span class="line"></span><br><span class="line">COMMAND：进程的名称</span><br><span class="line"></span><br><span class="line">PID：进程标识符</span><br><span class="line"></span><br><span class="line">PPID：父进程标识符（需要指定-R参数）</span><br><span class="line"></span><br><span class="line">USER：进程所有者</span><br><span class="line"></span><br><span class="line">PGID：进程所属组</span><br><span class="line"></span><br><span class="line">FD：文件描述符，应用程序通过文件描述符识别该文件。如cwd、txt等</span><br><span class="line"></span><br><span class="line">（1）cwd：表示current work dirctory，即：应用程序的当前工作目录，这是该应用程序启动的目录，除非它本身对这个目录进行更改</span><br><span class="line">（2）txt ：该类型的文件是程序代码，如应用程序二进制文件本身或共享库，如上列表中显示的 /sbin/init 程序</span><br><span class="line">（3）lnn：library references (AIX);</span><br><span class="line">（4）er：FD information error (see NAME column);</span><br><span class="line">（5）jld：jail directory (FreeBSD);</span><br><span class="line">（6）ltx：shared library text (code and data);</span><br><span class="line">（7）mxx ：hex memory-mapped type number xx.</span><br><span class="line">（8）m86：DOS Merge mapped file;</span><br><span class="line">（9）mem：memory-mapped file;</span><br><span class="line">（10）mmap：memory-mapped device;</span><br><span class="line">（11）pd：parent directory;</span><br><span class="line">（12）rtd：root directory;</span><br><span class="line">（13）tr：kernel trace file (OpenBSD);</span><br><span class="line">（14）v86  VP/ix mapped file;</span><br><span class="line">（15）0：表示标准输出</span><br><span class="line">（16）1：表示标准输入</span><br><span class="line">（17）2：表示标准错误</span><br><span class="line"></span><br><span class="line">一般在标准输出、标准错误、标准输入后还跟着文件状态模式：r、w、u等</span><br><span class="line"></span><br><span class="line">（1）u：表示该文件被打开并处于读取/写入模式</span><br><span class="line">（2）r：表示该文件被打开并处于只读模式</span><br><span class="line">（3）w：表示该文件被打开并处于</span><br><span class="line">（4）空格：表示该文件的状态模式为unknow，且没有锁定</span><br><span class="line">（5）-：表示该文件的状态模式为unknow，且被锁定</span><br><span class="line"></span><br><span class="line">同时在文件状态模式后面，还跟着相关的锁</span><br><span class="line"></span><br><span class="line">（1）N：for a Solaris NFS lock of unknown type;</span><br><span class="line">（2）r：for read lock on part of the file;</span><br><span class="line">（3）R：for a read lock on the entire file;</span><br><span class="line">（4）w：for a write lock on part of the file;（文件的部分写锁）</span><br><span class="line">（5）W：for a write lock on the entire file;（整个文件的写锁）</span><br><span class="line">（6）u：for a read and write lock of any length;</span><br><span class="line">（7）U：for a lock of unknown type;</span><br><span class="line">（8）x：for an SCO OpenServer Xenix lock on part      of the file;</span><br><span class="line">（9）X：for an SCO OpenServer Xenix lock on the      entire file;</span><br><span class="line">（10）space：if there is no lock.</span><br><span class="line"></span><br><span class="line">TYPE：文件类型，如DIR、REG等，常见的文件类型</span><br><span class="line"></span><br><span class="line">（1）DIR：表示目录</span><br><span class="line">（2）CHR：表示字符类型</span><br><span class="line">（3）BLK：块设备类型</span><br><span class="line">（4）UNIX： UNIX 域套接字</span><br><span class="line">（5）FIFO：先进先出 (FIFO) 队列</span><br><span class="line">（6）IPv4：网际协议 (IP) 套接字</span><br><span class="line"></span><br><span class="line">DEVICE：指定磁盘的名称</span><br><span class="line"></span><br><span class="line">SIZE：文件的大小</span><br><span class="line"></span><br><span class="line">NODE：索引节点（文件在磁盘上的标识）</span><br><span class="line"></span><br><span class="line">NAME：打开文件的确切名称</span><br></pre></td></tr></table></figure>
<h2 id="例子"><a href="#例子" class="headerlink" title="例子"></a>例子</h2><h3 id="查找谁在使用文件系统"><a href="#查找谁在使用文件系统" class="headerlink" title="查找谁在使用文件系统"></a>查找谁在使用文件系统</h3><p>在卸载文件系统时，如果该文件系统中有任何打开的文件，操作通常将会失败。那么通过lsof可以找出那些进程在使用当前要卸载的文件系统，如下：<br> lsof /GTES11/<br>COMMAND PID USER FD TYPE DEVICE SIZE NODE NAME<br>bash 4208 root cwd DIR 3,1 4096 2 /GTES11/<br>vim 4230 root cwd DIR 3,1 4096 2 /GTES11/<br>在这个示例中，用户root正在其/GTES11目录中进行一些操作。一个 bash是实例正在运行，并且它当前的目录为/GTES11，另一个则显示的是vim正在编辑/GTES11下的文件。要成功地卸载/GTES11，应该在通知用户以确保情况正常之后，中止这些进程。 这个示例说明了应用程序的当前工作目录非常重要，因为它仍保持着文件资源，并且可以防止文件系统被卸载。这就是为什么大部分守护进程（后台进程）将它们的目录更改为根目录、或服务特定的目录（如 sendmail 示例中的 /var/spool/mqueue）的原因，以避免该守护进程阻止卸载不相关的文件系统。</p>
<h3 id="恢复删除的文件"><a href="#恢复删除的文件" class="headerlink" title="恢复删除的文件"></a>恢复删除的文件</h3><p>当Linux计算机受到入侵时，常见的情况是日志文件被删除，以掩盖攻击者的踪迹。管理错误也可能导致意外删除重要的文件，比如在清理旧日志时，意外地删除了数据库的活动事务日志。有时可以通过lsof来恢复这些文件。<br>当进程打开了某个文件时，<em>只要该进程保持打开该文件，即使将其删除，它依然存在于磁盘中</em>。这意味着，进程并不知道文件已经被删除，它仍然可以向打开该文件时提供给它的文件描述符进行读取和写入。除了该进程之外，这个文件是不可见的，因为已经删除了其相应的目录索引节点。<br>在/proc 目录下，其中包含了反映内核和进程树的各种文件。/proc目录挂载的是在内存中所映射的一块区域，所以这些文件和目录并不存在于磁盘中，因此当我们对这些文件进行读取和写入时，实际上是在从内存中获取相关信息。大多数与 lsof 相关的信息都存储于以进程的 PID 命名的目录中，即 /proc/1234 中包含的是 PID 为 1234 的进程的信息。每个进程目录中存在着各种文件，它们可以使得应用程序简单地了解进程的内存空间、文件描述符列表、指向磁盘上的文件的符号链接和其他系统信息。lsof 程序使用该信息和其他关于内核内部状态的信息来产生其输出。所以lsof 可以显示进程的文件描述符和相关的文件名等信息。也就是我们通过访问进程的文件描述符可以找到该文件的相关信息。<br>当系统中的某个文件被意外地删除了，只要这个时候系统中还有进程正在访问该文件，那么我们就可以通过lsof从/proc目录下恢复该文件的内容。 假如由于误操作将/var/log/messages文件删除掉了，那么这时要将/var/log/messages文件恢复的方法如下：<br>首先使用lsof来查看当前是否有进程打开/var/logmessages文件，如下：<br><code>lsof |grep /var/log/messages</code><br>syslogd 1283 root 2w REG 3,3 5381017 1773647 /var/log/messages (deleted)<br>从上面的信息可以看到 PID 1283（syslogd）打开文件的文件描述符为 2。同时还可以看到/var/log/messages已经标记被删除了。因此我们可以在 /proc/1283/fd/2 （fd下的每个以数字命名的文件表示进程对应的文件描述符）中查看相应的信息，如下：<br><code>head -n 10 /proc/1283/fd/2</code><br>Aug 4 13:50:15 holmes86 syslogd 1.4.1: restart.<br>Aug 4 13:50:15 holmes86 kernel: klogd 1.4.1, log source = /proc/kmsg started.<br>Aug 4 13:50:15 holmes86 kernel: Linux version 2.6.22.1-8 (<a href="mailto:root@everestbuilder.linux-ren.org" target="_blank" rel="noopener">root@everestbuilder.linux-ren.org</a>) (gcc version 4.2.0) #1 SMP Wed Jul 18 11:18:32 EDT 2007 Aug 4 13:50:15 holmes86 kernel: BIOS-provided physical RAM map: Aug 4 13:50:15 holmes86 kernel: BIOS-e820: 0000000000000000 - 000000000009f000 (usable) Aug 4 13:50:15 holmes86 kernel: BIOS-e820: 000000000009f000 - 00000000000a0000 (reserved) Aug 4 13:50:15 holmes86 kernel: BIOS-e820: 0000000000100000 - 000000001f7d3800 (usable) Aug 4 13:50:15 holmes86 kernel: BIOS-e820: 000000001f7d3800 - 0000000020000000 (reserved) Aug 4 13:50:15 holmes86 kernel: BIOS-e820: 00000000e0000000 - 00000000f0007000 (reserved) Aug 4 13:50:15 holmes86 kernel: BIOS-e820: 00000000f0008000 - 00000000f000c000 (reserved)<br>从上面的信息可以看出，查看 /proc/8663/fd/15 就可以得到所要恢复的数据。如果可以通过文件描述符查看相应的数据，那么就可以使用 I/O 重定向将其复制到文件中，如:<br><code>cat /proc/1283/fd/2 &gt; /var/log/messages</code><br>对于许多应用程序，尤其是日志文件和数据库，这种恢复删除文件的方法非常有用。</p>
<h1 id="lsof对多线程的影响"><a href="#lsof对多线程的影响" class="headerlink" title="lsof对多线程的影响"></a>lsof对多线程的影响</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">mcu 13810 server1 7176r REG 8,1 1984229 2001190 /home/box/storage/kvdb/001125.ldb</span><br><span class="line">mcu 13810 server1 7177r REG 8,1 1984229 2001190 /home/box/storage/kvdb/001125.ldb</span><br><span class="line">mcu 13810 server1 7178r REG 8,1 1984229 2001190 /home/box/storage/kvdb/001125.ldb</span><br><span class="line">mcu 13810 server1 7179r REG 8,1 1984229 2001190 /home/box/storage/kvdb/001125.ldb</span><br><span class="line">mcu 13810 server1 7180r REG 8,1 1984229 2001190 /home/box/storage/kvdb/001125.ldb</span><br><span class="line">mcu 13810 server1 7181r REG 8,1 1984229 2001190 /home/box/storage/kvdb/001125.ldb</span><br><span class="line">mcu 13810 server1 7182r REG 8,1 1984229 2001190 /home/box/storage/kvdb/001125.ldb</span><br></pre></td></tr></table></figure>
<p>lsof列出的多个线程并不代表每个线程占用了一个句柄，而是代表这些线程对这个文件有访问权限，实际上只要这个进程打开了这个文件，lsof都会列出所有子线程。</p>
<p><a href="https://github.com/Tencent/phxpaxos/issues/15" target="_blank" rel="noopener">https://github.com/Tencent/phxpaxos/issues/15</a></p>
<h2 id="so-通过lsof观察如何数量过多-并不一定是文件句柄泄漏-可能是多线程进行访问"><a href="#so-通过lsof观察如何数量过多-并不一定是文件句柄泄漏-可能是多线程进行访问" class="headerlink" title="so 通过lsof观察如何数量过多,并不一定是文件句柄泄漏,可能是多线程进行访问"></a>so 通过lsof观察如何数量过多,并不一定是文件句柄泄漏,可能是多线程进行访问</h2><h1 id="file-leak-detector-待测试"><a href="#file-leak-detector-待测试" class="headerlink" title="file-leak-detector(待测试)"></a>file-leak-detector(待测试)</h1><p>官网:<br><a href="http://file-leak-detector.kohsuke.org/" target="_blank" rel="noopener">http://file-leak-detector.kohsuke.org/</a></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="http://www.cnblogs.com/peida/archive/2013/02/26/2932972.html" target="_blank" rel="noopener">http://www.cnblogs.com/peida/archive/2013/02/26/2932972.html</a><br><a href="https://www.cnblogs.com/ggjucheng/archive/2012/01/08/2316599.html" target="_blank" rel="noopener">https://www.cnblogs.com/ggjucheng/archive/2012/01/08/2316599.html</a><br><a href="https://blog.coding.net/blog/java-file-leaks" target="_blank" rel="noopener">https://blog.coding.net/blog/java-file-leaks</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/05/java-io-study/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Victor">
      <meta itemprop="description" content="victor的个人博客,作为一枚后端开发工程师,写本博客目的,旨在记录自己在工作生活中的点点滴滴,形成自己的知识体系">
      <meta itemprop="image" content="/images/tennis.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Victor的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/05/java-io-study/" itemprop="url">
                  java-io-study
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-05 07:05:09" itemprop="dateCreated datePublished" datetime="2018-07-05T07:05:09+08:00">2018-07-05</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-07-07 21:29:09" itemprop="dateModified" datetime="2018-07-07T21:29:09+08:00">2018-07-07</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/05/java-io-study/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/07/05/java-io-study/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/07/05/java-io-study/" class="leancloud_visitors" data-flag-title="java-io-study">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p>IO(Input And Output)在编程中是一个很常见的需求，IO即意味着我们的java程序需要和”外部”进行通信，这个”外部”可以是很多介质</p>
<ol>
<li>本地磁盘文件、远程磁盘文件</li>
<li>数据库连接</li>
<li>TCP、UDP、HTTP网络通信</li>
<li>进程间通信</li>
<li>硬件设备(键盘、串口等)</li>
</ol>
<p><img src="/images/pasted-205.png" alt="upload successful"></p>
<h1 id="java-io体系"><a href="#java-io体系" class="headerlink" title="java io体系"></a>java io体系</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">Object(超类)</span><br><span class="line">1. 基于&quot;字节&quot;操作的 I/O 接口:</span><br><span class="line">    1) InputStream</span><br><span class="line">    InputStream类是一个abstract class(抽象父类)，它不能被直接用于实例化进行流操作，我们在编程中使用的是它的子类</span><br><span class="line">        1.1) ByteArrayInputStream: 从字节数组(byte[])中进行以字节为单位的读取</span><br><span class="line">        1.2) FileInputStream: 从文件中进行以字节为单位的读取</span><br><span class="line">            1.2.1) SocketInputStream</span><br><span class="line">            org.apache.commons.net.io.SocketInputStream: 封装了对Socket的字节型流式读取</span><br><span class="line">        1.3) FilterInputStream: 用来&quot;封装其它的输入流，并为它们提供额外的功能&quot;</span><br><span class="line">            1.3.1) InflaterInputStream </span><br><span class="line">            java.util.zip.InflaterInputStream: 从压缩数据源(zip)中以字节为单位读取数据</span><br><span class="line">                1.3.1.1) ZipInputStream </span><br><span class="line">                java.util.zip.ZipInputStream: 从zip文件中以字节为单位读取数据</span><br><span class="line">            1.3.2) BufferedInputStream: 开辟&quot;内部字节数组&quot;对输入流进行缓存，函数的返回也是一个字节数组</span><br><span class="line">            1.3.3) DataInputStream:</span><br><span class="line">            DataInputStream 是用来装饰其它输入流，它&quot;允许应用程序以与机器无关方式从底层输入流中读取基本 Java 数据类型&quot;。应用程序可以使用DataOutputStream(数据输出流)</span><br><span class="line">　　　　　　　写入由DataInputStream(数据输入流)读取的数据。</span><br><span class="line">        1.4) ObjectInputStream: 从输入流中读取序列化后的数据，并进行反序列化(deserializes)</span><br><span class="line">        1.5) PipedInputStream: 从管道中读取数据</span><br><span class="line">    2) OutputStream</span><br><span class="line">    OutputStream类是一个abstract class(抽象父类)，它不能被直接用于实例化进行流操作，我们在编程中使用的是它的子类</span><br><span class="line">        2.1) ByteArrayOutputStream: 以字节为单位将数据写入到从字节数组(byte[])中 </span><br><span class="line">        2.2) FileOutputStream: 以字节为单位将数据写入到文件中</span><br><span class="line">            2.2.1) SocketOutputStream</span><br><span class="line">            org.apache.commons.net.io.SocketOutputStream: 封装了对Socket的字节型流式写入</span><br><span class="line">        2.3) FilterOutputStream: 用来&quot;封装其它的输出流，并为它们提供额外的功能&quot;</span><br><span class="line">            2.3.1) ZipOutputStream: java.util.zip.ZipOutputStream: 以字节为单位向zip文件写入数据</span><br><span class="line">            2.3.2) PrintStream: </span><br><span class="line">            PrintStream 是用来装饰其它输出流。它能为其他输出流添加了功能，使它们能够方便地打印各种数据值表示形式</span><br><span class="line">            2.3.3) DataOutputStream:</span><br><span class="line">            DataOutputStream 是用来装饰其它输入流，它&quot;允许应用程序以与机器无关方式向底层输出流中写入基本 Java 数据类型&quot;。应用程序可以使用DataInputStream(数据输入流)</span><br><span class="line">　　　　　　　写入由DataOutputStream(数据输出流)写入的数据()。有点类似管道、或者进程间通信的感觉</span><br><span class="line">　　　　　　　2.3.4) BufferedInputStream: </span><br><span class="line">        2.4) ObjectOutputStream: 对数据进行序列化(serializes)，并向输出流中写入序列化后的数据</span><br><span class="line">        2.5) PipedOutputStream: 向管道中写入数据</span><br><span class="line">2. 基于&quot;字符&quot;操作的 I/O 接口</span><br><span class="line">不管是磁盘还是网络传输，最小的存储单元都是字节，而不是字符，所以 I/O 操作的都是字节而不是字符，为了操作方便，java封装了一个直接写字符的 I/O 接口，这里就涉及到java的流机制</span><br><span class="line">中的一个很重要的概念，包装(装饰)。即所有的流操作在底层实现都是字节流的形式，以这个底层字节流为基础，在其上封装了各种&quot;附加功能&quot;(缓存、字符、管道..)</span><br><span class="line">    1) Reader</span><br><span class="line">    Reader类是一个abstract class(抽象父类)，它不能被直接用于实例化进行流操作，我们在编程中使用的是它的子类</span><br><span class="line">        1.1) InputStreamReader:</span><br><span class="line">        我们知道，字符型的流接口是在字节型的流接口基础之上进行了一次封装，提供了一些额外的功能。所以，从名字上也可以看出来，InputStreamReader是字节流通向字符流的桥梁,　　　　 </span><br><span class="line">　　　　 封裝了InputStream在里头, 它以较高级的方式,一次读取一个一个字符，以文本格式输入/输出，可以指定编码格式。</span><br><span class="line">            1.1.1) FileReader: 提供对文本文件(保存字符的文件)进行以字符为单位的读取</span><br><span class="line">        1.2) BufferedReader:</span><br><span class="line">        BufferedReader会一次性从物理流中读取8k(默认数值,可以设置)字节内容到内存，如果外界有请求，就会到这里存取，如果内存里没有才到物理流里再去读。即使读，也是再8k</span><br><span class="line">　　　　 而直接读物理流，是按字节来读。对物理流的每次读取，都有IO操作。IO操作是最耗费时间的。BufferedReader就是减少了大量IO操作，节省了时间</span><br><span class="line">        1.3) CharArrayReader:</span><br><span class="line">        CharArrayReader 是字符数组输入流。它和ByteArrayInputStream类似，只不过ByteArrayInputStream是字节数组输入流，而CharArray是字符数组输入流。</span><br><span class="line">　　　　 CharArrayReader 是用于读取字符数组，它继承于Reader。操作的数据是以字符为单位</span><br><span class="line">        1.4) FilterReader: 用来&quot;封装其它的字符输入流，并为它们提供额外的功能&quot;</span><br><span class="line">        1.5) PipedReader: PipedReader 是字符管道输入流，它继承于Reader。</span><br><span class="line">        1.6) StringReader: 以String作为数据源，进行以字符为单位的读取</span><br><span class="line">　　    2) Writer</span><br><span class="line">   　　 Writer类是一个abstract class(抽象父类)，它不能被直接用于实例化进行流操作，我们在编程中使用的是它的子类</span><br><span class="line">        2.1) OutputStreamWriter:</span><br><span class="line">            2.1.1) FileWriter: 提供对文本文件(保存字符的文件)进行以字符为单位的写入</span><br><span class="line">        2.2) BufferedWriter</span><br><span class="line">        2.3) StringWriter</span><br><span class="line">        2.4) PipedWriter</span><br><span class="line">        2.5) PrintWriter </span><br><span class="line">        2.6) CharArrayWriter</span><br><span class="line">3. 基于&quot;磁盘&quot;操作的 I/O 接口:</span><br><span class="line">    1) File: (文件特征与管理): 用于文件或者目录的描述信息，例如生成新目录，修改文件名，删除文件，判断文件所在路径等，它不负责数据的输入输出，而专门用来管理磁盘文件与目录</span><br><span class="line">        1) public boolean exists( )        判断文件或目录是否存在</span><br><span class="line">        2) public boolean isFile( )        判断是文件还是目录 </span><br><span class="line">        3) public boolean isDirectory( )    判断是文件还是目录</span><br><span class="line">        4) public String getName( )        返回文件名或目录名</span><br><span class="line">        5) public String getPath( )        返回文件或目录的路径。</span><br><span class="line">        6) public long length( )        获取文件的长度 </span><br><span class="line">        7) public String[] list( )        将目录中所有文件名保存在字符串数组中返回  </span><br><span class="line">        8) public boolean renameTo( File newFile );    重命名文件</span><br><span class="line">        9) public void delete( );        删除文件</span><br><span class="line">        10) public boolean mkdir( );        创建目录</span><br><span class="line">4. 基于网络操作的 I/O 接口:</span><br><span class="line">    1) Socket</span><br></pre></td></tr></table></figure>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="http://www.cnblogs.com/LittleHann/p/3678685.html" target="_blank" rel="noopener">http://www.cnblogs.com/LittleHann/p/3678685.html</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/04/其他/How-To-Ask-Questions-The-Smart-Way/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Victor">
      <meta itemprop="description" content="victor的个人博客,作为一枚后端开发工程师,写本博客目的,旨在记录自己在工作生活中的点点滴滴,形成自己的知识体系">
      <meta itemprop="image" content="/images/tennis.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Victor的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/07/04/其他/How-To-Ask-Questions-The-Smart-Way/" itemprop="url">
                  How-To-Ask-Questions-The-Smart-Way
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-04 09:21:09" itemprop="dateCreated datePublished" datetime="2018-07-04T09:21:09+08:00">2018-07-04</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-07-05 06:55:33" itemprop="dateModified" datetime="2018-07-05T06:55:33+08:00">2018-07-05</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/04/其他/How-To-Ask-Questions-The-Smart-Way/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/07/04/其他/How-To-Ask-Questions-The-Smart-Way/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/07/04/其他/How-To-Ask-Questions-The-Smart-Way/" class="leancloud_visitors" data-flag-title="How-To-Ask-Questions-The-Smart-Way">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>中文版地址:<br><a href="https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/master/README-zh_CN.md" target="_blank" rel="noopener">https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/master/README-zh_CN.md</a></p>
<p>如何有效的报告bug<br><a href="https://www.chiark.greenend.org.uk/~sgtatham/bugs-cn.html" target="_blank" rel="noopener">https://www.chiark.greenend.org.uk/~sgtatham/bugs-cn.html</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  
    
  

  

  <article class="post post-type-normal post-sticky" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/07/03/web-list/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Victor">
      <meta itemprop="description" content="victor的个人博客,作为一枚后端开发工程师,写本博客目的,旨在记录自己在工作生活中的点点滴滴,形成自己的知识体系">
      <meta itemprop="image" content="/images/tennis.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Victor的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                  <span class="post-sticky-flag" title="置顶">
                    <i class="fa fa-thumb-tack"></i>
                  </span>
                
                <a class="post-title-link" href="/2018/07/03/web-list/" itemprop="url">
                  常用网址
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2018-07-03 21:54:54" itemprop="dateCreated datePublished" datetime="2018-07-03T21:54:54+08:00">2018-07-03</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2018-07-09 17:13:15" itemprop="dateModified" datetime="2018-07-09T17:13:15+08:00">2018-07-09</time>
              
            
          </span>

          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/07/03/web-list/#comments" itemprop="discussionUrl">
                
                  <span class="post-comments-count disqus-comment-count"
                        data-disqus-identifier="2018/07/03/web-list/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2018/07/03/web-list/" class="leancloud_visitors" data-flag-title="常用网址">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="jdk8规范"><a href="#jdk8规范" class="headerlink" title="jdk8规范:"></a>jdk8规范:</h1><p><a href="https://docs.oracle.com/javase/specs/jls/se8/html/" target="_blank" rel="noopener">https://docs.oracle.com/javase/specs/jls/se8/html/</a></p>
<h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="springmvc-文档"><a href="#springmvc-文档" class="headerlink" title="springmvc 文档"></a>springmvc 文档</h2><p><a href="https://docs.spring.io/spring-framework/docs/3.2.x/spring-framework-reference/html/" target="_blank" rel="noopener">https://docs.spring.io/spring-framework/docs/3.2.x/spring-framework-reference/html/</a></p>
<h2 id="jersey-文档"><a href="#jersey-文档" class="headerlink" title="jersey 文档"></a>jersey 文档</h2><p><a href="https://jersey.github.io/documentation/latest" target="_blank" rel="noopener">https://jersey.github.io/documentation/latest</a></p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/21/">21</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/tennis.jpg"
                alt="Victor" />
            
              <p class="site-author-name" itemprop="name">Victor</p>
              <p class="site-description motion-element" itemprop="description">victor的个人博客,作为一枚后端开发工程师,写本博客目的,旨在记录自己在工作生活中的点点滴滴,形成自己的知识体系</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">204</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">27</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">77</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/victorsheng" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="psychovitor@gmail.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
            </div>
          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
            <span id="scrollpercent"><span>0</span>%</span>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2017 &mdash; <span itemprop="copyrightYear">2018</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Victor</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Muse</a></div>



  <div class="footer-custom">Hosted by <a target="_blank" rel="external nofollow" href="https://pages.coding.me"><b>Coding Pages</b></a></div>


        








        
      </div>
    </footer>

    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  

  
    <script id="dsq-count-scr" src="https://victor123-cn.disqus.com/count.js" async></script>
  

  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("QdvsGi5rrGt05B6T1cP9buCX-gzGzoHsz", "IPzdnLkdvxDPxh2zyHn82bWk");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            
            counter.save(null, {
              success: function(counter) {
                
                  var $element = $(document.getElementById(url));
                  $element.find('.leancloud-visitors-count').text(counter.get('time'));
                
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            
              var $element = $(document.getElementById(url));
              $element.find('.leancloud-visitors-count').text('Counter not initialized! See more at console err msg.');
              console.error('ATTENTION! LeanCloud counter has security bug, see here how to solve it: https://github.com/theme-next/hexo-leancloud-counter-security. \n But you also can use LeanCloud without security, by set \'security\' option to \'false\'.');
            
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  

  
  

  

  
  <script type="text/javascript" src="/js/src/js.cookie.js?v=6.3.0"></script>
  <script type="text/javascript" src="/js/src/scroll-cookie.js?v=6.3.0"></script>


  

  

  

</body>
</html>
